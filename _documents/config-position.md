# 配置文件定位

## 术语定义

* **配置文件**：存在于文件系统或云端配置中心的文件实体，caramel-config 的消费对象，最终由 caramel-config 加载为**配置数据**。

* **配置数据**：由 caramel-config 生产的对象，其内容来源于**配置文件**，可能由多个**配置文件**的内容组合而成，使用 key 属性作为其唯一标识。

* **定位描述**：用于描述配置文件所在位置的属性集合，包括文件名、扩展名、路径、唯一标识、优先级。可以使用一个对象表示，也可以用一个字符串表示。

## 定位描述对象

用于描述配置文件所在位置的对象。

### name

* 配置文件的文件名。
* 必选项。

### path

* 配置文件所在路径。
* 可以是文件系统路径，前缀 `file:` ，如绝对路径 `file:/home/config`，相对路径 `file:./config`。
* 也可以是 classpath 路径，前缀 `classpath:` 或无前缀，如 `classpath:/`、`/config`。
* 可选项，若不指定，则从 `classpath:/`、`classpath:/config/`、`file:./`、`file:./config/` 四个约定路径中查找，其优先级按前述顺序递增。

### extension

* 配置文件的扩展名。
* 可选项，若不指定，则分别以 `[无扩展名]`、`.properties`、`.json`、`.conf` 作为扩展名进行查找，其优先级按前述顺序递增。

### key

* 配置数据的唯一标识。
* 若有多个配置文件指定了相同的 key，则会合并这些文件的内容。
* 若这些文件中包含同名的选项，将会按照文件的优先级（priority）进行覆盖。
* 可选项，若不指定 key，则以 name 作为 key（忽略 path 和 extension）。

### priority

* 配置文件的优先级，必须为数字类型，可以是小数和负数，数值越大表示优先级越高。
* 若设置了多个同 key 的配置文件，在合并其内容时，对于同名选项将按优先级进行覆盖。
* 可选项，若未指定，则根据配置文件加载顺序，后加载的优先级更高（通常时编写顺序，但不作保障）。
* 指定了 priority 的配置文件优先级总是高于未指定 priority 的配置文件。
* 在未指定 priority 的情况下，云端配置中心优先级高于本地。

## 定位描述字符串

用于描述配置文件所在位置的字符串。

格式为：`[$key:][#priority:][path/]name[.extension]`。

如：`$redis-master:#100:/config/redis.conf`。

* 除了 name 部分，其它部分均为可选项。
* key 必须以 `$` 符号开头，以 `:` 结尾。
* priority 必须以 `#` 符号开头，以 `:` 结尾。
* key 和 priority 之间顺序可以互换，其它部分的顺序固定。
* 定位规则和**定位描述对象**一致。
